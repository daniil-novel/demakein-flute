# Руководство по созданию диагональной флейты в Demakin

## Что такое диагональная флейта?

Диагональная флейта - это тип поперечной флейты, где отверстия для пальцев расположены под углом к основной оси инструмента. Это обеспечивает более удобное положение рук и пальцев при игре, особенно для людей с разной длиной пальцев.

## Основные принципы

### 1. Углы отверстий

В demakin для создания диагональной флейты используются два типа углов:

- **`hole_horiz_angles`** - горизонтальные углы (поворот влево/вправо)
  - 0° - отверстие направлено прямо вперед
  - Положительные значения - поворот вправо
  - Отрицательные значения - поворот влево

- **`hole_angles`** - вертикальные углы (наклон вверх/вниз)
  - 0° - отверстие горизонтально
  - Положительные значения - наклон вверх
  - Отрицательные значения - наклон вниз

### 2. Базовый класс

Диагональная флейта наследуется от `design_flute.Tapered_flute`:

```python
class Design_diagonal_flute(design_flute.Tapered_flute):
    # Ваши настройки здесь
```

## Пример создания простой диагональной флейты

```python
import demakein
from demakein import design, design_flute

class Design_diagonal_flute(design_flute.Tapered_flute):
    # Количество отверстий
    n_holes = 8
    
    # Горизонтальные углы (диагональное расположение)
    hole_horiz_angles = [
        0.0,    # 1-е отверстие - прямо
        15.0,   # 2-е отверстие - слегка вправо
        -15.0,  # 3-е отверстие - слегка влево  
        30.0,   # 4-е отверстие - больше вправо
        -30.0,  # 5-е отверстие - больше влево
        45.0,   # 6-е отверстие - сильно вправо
        -45.0,  # 7-е отверстие - сильно влево
        0.0     # 8-е отверстие - прямо
    ]
    
    # Вертикальные углы (наклон для удобства)
    hole_angles = [
        0.0,    # 1-е отверстие - горизонтально
        -5.0,   # 2-е отверстие - слегка вниз
        -5.0,   # 3-е отверстие - слегка вниз
        -10.0,  # 4-е отверстие - больше вниз
        -10.0,  # 5-е отверстие - больше вниз
        -15.0,  # 6-е отверстие - сильно вниз
        -15.0,  # 7-е отверстие - сильно вниз
        -20.0   # 8-е отверстие - максимально вниз
    ]
```

## Ключевые параметры

### Обязательные параметры:

1. **`n_holes`** - количество отверстий
2. **`hole_horiz_angles`** - список горизонтальных углов для каждого отверстия
3. **`hole_angles`** - список вертикальных углов для каждого отверстия
4. **`fingerings`** - аппликатуры (какие отверстия закрывать для каждой ноты)

### Дополнительные параметры:

- **`min_hole_diameters`** / **`max_hole_diameters`** - диапазон диаметров отверстий
- **`embextra`** - параметр эмбушюра (обычно 0.53)
- **`inner_taper`** / **`outer_taper`** - конусность внутреннего и внешнего каналов
- **`transpose`** - транспозиция в полутонах

## Как использовать

### 1. Создание дизайна флейты:

```bash
python design_diagonal_flute.py design-diagonal output_diagonal
```

### 2. Создание 3D модели:

```bash
python design_diagonal_flute.py make-flute output_diagonal/data.pickle output_3d
```

## Советы по настройке углов

### Для правшей:
- Отверстия для левой руки (верхние): небольшие углы влево (-10° до -30°)
- Отверстия для правой руки (нижние): углы вправо (10° до 45°)

### Для левшей:
- Инвертируйте знаки углов

### Вертикальные углы:
- Верхние отверстия: 0° до -5°
- Средние отверстия: -5° до -15°
- Нижние отверстия: -15° до -25°

## Примеры схем расположения

### Простая диагональ (8 отверстий):
```
Отверстие:  1    2    3    4    5    6    7    8
Гориз. угол: 0°  15° -15°  30° -30°  45° -45°   0°
Верт. угол:  0°  -5°  -5° -10° -10° -15° -15° -20°
```

### Продвинутая диагональ (10 отверстий):
```
Отверстие:  1    2    3    4    5    6    7    8    9   10
Гориз. угол: 0°  20° -20°  40° -40°  60° -60°  30° -30°   0°
Верт. угол:  0°  -3°  -3°  -6°  -6° -12° -12° -18° -18° -25°
```

## Аппликатуры

Аппликатуры определяют, какие отверстия нужно закрывать для каждой ноты:
- `1` = отверстие закрыто
- `0` = отверстие открыто

Пример:
```python
fingerings = [
    ('C4',  [1, 1, 1, 1, 1, 1, 1, 1]),  # Все отверстия закрыты
    ('D4',  [0, 1, 1, 1, 1, 1, 1, 1]),  # Первое отверстие открыто
    ('E4',  [0, 0, 1, 1, 1, 1, 1, 1]),  # Первые два открыты
    # и так далее...
]
```

## Отладка и настройка

1. **Начните с простых углов** (±15°, ±30°)
2. **Проверьте акустику** - запустите дизайн и посмотрите на результаты
3. **Постепенно увеличивайте углы** для большего удобства
4. **Тестируйте аппликатуры** - убедитесь, что все ноты играют правильно

## Файлы в проекте

- `design_diagonal_flute.py` - основной файл с классами диагональных флейт
- `Design_diagonal_flute` - простая диагональная флейта (8 отверстий)
- `Design_diagonal_flute_advanced` - продвинутая версия (10 отверстий)

## Результаты

После выполнения дизайна в выходной папке появятся:
- `data.pickle` - данные дизайна для создания 3D модели
- `diagram.svg` - схема флейты с размерами
- Другие файлы с акустическими характеристиками

Эти файлы можно использовать для создания физической флейты или дальнейшего анализа.
